@using System.Web.Optimization
@model BAR.UI.MVC.Models.ItemViewModels.ItemCreateViewModel

@section CustomCSS{
    @Styles.Render("~/bundles/datatables-css", "~/bundles/datatables-buttons-css")
}

<h1>@Model.PageTitle</h1>

@using (Html.BeginForm("UploadJson", "Admin", FormMethod.Post, new { role = "form", enctype = "multipart/form-data" }))
{
<label for="fileUpload" style="visibility:hidden; width:0px"></label>
<input type="file" style="display:none;" class="btn btn-dark" name="jsonFile" id="fileUpload" accept=".json" />
<button type="submit" id="btnSubmit" style="display: inline-block;" class="btn btn-dark">@Resources.ImportContent</button>
}

@using (Html.BeginForm("UploadThemes", "Admin", FormMethod.Post, new { role = "form", enctype = "multipart/form-data" }))
{
    <label for="themeFileUpload" class="btn btn-dark btn-xs" style="display: inline-block;">Import Themes</label>
    <input type="file" style="display:none;" class="btn btn-dark" name="jsonFileThemes" id="themeFileUpload" accept=".json" />
    <button type="submit" id="btnThemeSubmit" style="visibility:hidden;" class="btn btn-dark">@Resources.Save</button>
}

@Html.Partial("Partials/_CreateItemModal")

<hr />


@Html.Partial("Partials/_ItemTable", Model)

<div style="visibility: hidden">space</div>


@section CustomJS{
    @Scripts.Render("~/bundles/datatables")
    @Scripts.Render("~/bundles/datatables-buttons", "~/bundles/datatables-buttons-bs")
    <script src="~/Scripts/DataExport/jszip.min.js"></script>
    <script src="~/Scripts/DataExport/pdfmake.min.js"></script>
    <script src="~/Scripts/DataExport/vfs_fonts.js"></script>
    <script src="~/Scripts/DataExport/buttons.html5.min.js"></script>

    <script type="text/javascript">
        (() => {
            $('#datatable-buttons').dataTable({
                "sScrollY": "700px",
                "paging": true,
                dom: "lBfrtip",
                buttons: [
                    'copy', 'excelHtml5', 'pdfHtml5', 'csvHtml5'
                ]
            });

            var wto;
            $(".removeItem").click(function() {
                clearTimeout(wto);
                var $this = $(this);
                var id = $this.data('item-id');
                var text = $this.html();
                $this.html("<i class='fa fa-circle-o-notch fa-spin'></i>");
                wto = setTimeout(function() {
                        $.ajax({
                                type: 'POST',
                                url: '/api/Admin/ToggleDeleteItem/' + id
                            }).fail(() => { alert("@Resources.CannotRemoveItem") })
                            .done(function() {
                                if (text === "@Resources.Recover") $this.html("@Resources.Remove");
                                else $this.html("@Resources.Recover");
                                $this.toggleClass("btn-danger btn-dark");
                            });
                    },
                    500);
            });

            $(".renameItem").on('input propertychange paste',
                function() {
                    clearTimeout(wto);
                    var $this = $(this);
                    var id = $this.data('item-id');
                    $this.addClass("loadMessage");
                    wto = setTimeout(function() {
                            $.ajax({
                                    type: 'POST',
                                    url: '/api/Admin/RenameItem/' + id + '/' + $this.val()
                                }).fail(() => { /**/ })
                                .done(function() {
                                    $this.removeClass("loadMessage");
                                });
                        },
                        1000);
                });
        })($);
    </script>
    <script>
        $(document).ready(function () {
            $('#fileUpload').change(function () {
                $('#btnSubmit').click();
            });
            $('#themeFileUpload').change(function () {
                $('#btnThemeSubmit').click();
            });
        });
    </script>
}