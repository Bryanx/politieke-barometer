@using System.Web.Optimization
@model BAR.UI.MVC.Models.EditUserViewModel

@section CustomCSS{
    @Styles.Render("~/bundles/datatables")
}

<h1>@Model.PageTitle</h1>
<hr />
@if (User.IsInRole("Admin")) {
    @Html.Partial("Partials/_UserTable", Model)
} else {
    @Html.Partial("Partials/_AdminTable", Model)
}
<div style="visibility: hidden">space</div>

@section CustomJS{
    @Scripts.Render("~/bundles/datatables")
    @Scripts.Render("~/bundles/datatables-buttons", "~/bundles/datatables-buttons-bs")

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.2.0/js/buttons.html5.min.js"></script>
    
    <script type="text/javascript">
            (() => {
                $('#datatable-buttons').dataTable({
                    "sScrollY": "700px",
                    "paging": true,
                    dom: "lBfrtip",
                    buttons: [
                        'copy', 'excelHtml5', 'pdfHtml5', 'csvHtml5'
                    ]
                });

            })($);
    </script>

    <script type="text/javascript">
        (() => {
            $('#datatable-buttons').dataTable({
                "sScrollY": "700px",
                "paging": true,
                dom: "lBfrtip",
                buttons: [
                    'copy', 'excelHtml5', 'pdfHtml5', 'csvHtml5'
                ]
            });
        });

        $('.accountActivityChange').click(function() {
            var $this = $(this);
            var id = $this.data('item-id');
            console.log($this.text());
            $.ajax({
                    type: 'POST',
                    url: '/api/Admin/ToggleAccountActivity/' + id
                }).fail(() => {/* ok */ })
                .done(function () {
                    $this.toggleClass("btn-danger btn-success")
                        .toggleText("@Resources.Recover", "@Resources.Remove")
                        .parent().parent().toggleClass("greyed-out");
                });
        });
        
        function changeRole(id, htmlId) {
            $.ajax({
                    type: "POST",
                    url: "/api/Admin/ChangeRole/" + id,
                    contentType: 'application/json; charset=utf-8',
                    dataType: "json",
                    data: JSON.stringify($("#dd" + htmlId + " option:selected").text())
                }).fail(() => {/* ok */ })
                .done(function () {
                    $("#td2" + htmlId).text($("#dd" + htmlId + " option:selected").text());
                });
            event.preventDefault();
        }
    </script>
}